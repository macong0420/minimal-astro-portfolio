---
title: "å°å¸ˆå‚… AI çš„æ¶æ„è®¾è®¡"
description: "å°å¸ˆå‚… AI çš„æ¶æ„è®¾è®¡"
publishedAt: "2025-12-18"
tags:
  - "æ¶æ„"
  - "ai"
---

## 1. èƒŒæ™¯ä¸æŒ‘æˆ˜ (Why)

åœ¨æ„å»ºæ™ºèƒ½å®¢æœåŠ©æ‰‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¢ä¸´ä¸‰ä¸ªæ ¸å¿ƒæŠ€æœ¯ç—›ç‚¹ï¼Œç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒä¸ç ”å‘æ•ˆç‡ï¼š

- **å®æ—¶æ€§ä½“éªŒç“¶é¢ˆ**ï¼šç”¨æˆ·æœŸæœ› AI å›å¤å…·æœ‰â€œæµå¼æ‰“å­—æœºâ€æ•ˆæœï¼Œè€Œéé•¿æ—¶é—´ç­‰å¾…åçš„å…¨é‡è¿”å›ã€‚
    
- **ä»£ç ç»´æŠ¤ç¾éš¾**ï¼šæ”¯æŒæ–‡æœ¬ã€å¡ç‰‡ã€å¤šé€‰ã€è¯„ä»·ç­‰ 8+ ç§å¤æ‚æ¶ˆæ¯ç±»å‹ã€‚ä¼ ç»Ÿçš„ `if-else` æˆ– `switch` é€»è¾‘å¯¼è‡´è§£æå±‚è‡ƒè‚¿ï¼ˆ300+ è¡Œé‡å¤ä»£ç ï¼‰ï¼Œæ‰©å±•æå…¶å›°éš¾ã€‚
    
- **æ€§èƒ½ç¨³å®šæ€§å‹åŠ›**ï¼šåœ¨é•¿å¯¹è¯åœºæ™¯ä¸‹ï¼Œé¢‘ç¹çš„æµå¼æ•°æ®æ›´æ–°æ˜“è§¦å‘å…¨å±€é‡ç»˜ï¼ˆRebuildï¼‰ï¼Œå¯¼è‡´ UI å¡é¡¿æˆ– OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰ã€‚
    

---

## 2. æ ¸å¿ƒæ¶æ„è®¾è®¡æ€è·¯ (How)

### A. é€šè®¯åè®®ï¼šSSE (Server-Sent Events) æµå¼äº¤äº’

ç›¸æ¯”äº WebSocketï¼Œæˆ‘é€‰æ‹©äº†æ›´è½»é‡çº§çš„ **SSE** æ–¹æ¡ˆï¼š

- **é€‰å‹é€»è¾‘**ï¼šAI å¯¹è¯æœ¬è´¨æ˜¯å•å‘æ•°æ®æµï¼ˆæœåŠ¡ç«¯æ¨é€ï¼‰ï¼ŒSSE åŸç”Ÿæ”¯æŒ HTTPï¼Œå…·å¤‡è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼Œä¸”å¯¹ä¼ä¸šé˜²ç«å¢™æ›´å‹å¥½ã€‚
    
- **è‡ªç ”å®¢æˆ·ç«¯**ï¼šå°è£…è‡ªå®šä¹‰ `SSEClient` æ›¿ä»£ç¬¬ä¸‰æ–¹åº“ï¼Œæ·±åº¦å®šåˆ¶äº†é‡è¿ç­–ç•¥ï¼ˆæŒ‡æ•°é€€é¿ç®—æ³•ï¼‰ä¸é”™è¯¯æ‹¦æˆªæœºåˆ¶ï¼Œç¡®ä¿é•¿è¿æ¥çš„ç¨³å®šæ€§ã€‚

> SSEåè®®**å†…ç½®äº†è‡ªåŠ¨é‡è¿æœºåˆ¶**ï¼šå½“æµè§ˆå™¨ä¸æœåŠ¡å™¨çš„è¿æ¥æ„å¤–æ–­å¼€æ—¶ï¼Œæµè§ˆå™¨ï¼ˆé€šè¿‡[EventSource](https://www.google.com/search?q=EventSource&mstk=AUtExfD4k-H1zLkKNieG3LHeEYQiTTR08D6tnYzotxg1ZpHlStFXPT0qYs4qHgj6e1VZHj7a9193CJZPdf5-bApTnz0VjrQzRxOEjh14bCn9zs8e9qtCNUOOiYHKLOwnmfxH137usJMdJ3NNswahx8FT58EkRjOMlctF5xzkENiZAoVFqd6rdnhB7lHLPwMP6rP7HoKdbE0dYSFv817ffrnN9uKRBzYR1Yn874z969hOrNJrgCfHhwpeqfs4OsQ2sMeA5ByAx8kYDat1G5SeQT6UIeta&csui=3&ved=2ahUKEwjpr-S-9N-RAxXMTmwGHRxaDzMQgK4QegQIARAB)æ¥å£ï¼‰ä¼š**è‡ªåŠ¨**å°è¯•é‡æ–°è¿æ¥ï¼Œå¹¶æºå¸¦æœ€åæ¥æ”¶çš„[Event ID](https://www.google.com/search?q=Event+ID&mstk=AUtExfD4k-H1zLkKNieG3LHeEYQiTTR08D6tnYzotxg1ZpHlStFXPT0qYs4qHgj6e1VZHj7a9193CJZPdf5-bApTnz0VjrQzRxOEjh14bCn9zs8e9qtCNUOOiYHKLOwnmfxH137usJMdJ3NNswahx8FT58EkRjOMlctF5xzkENiZAoVFqd6rdnhB7lHLPwMP6rP7HoKdbE0dYSFv817ffrnN9uKRBzYR1Yn874z969hOrNJrgCfHhwpeqfs4OsQ2sMeA5ByAx8kYDat1G5SeQT6UIeta&csui=3&ved=2ahUKEwjpr-S-9N-RAxXMTmwGHRxaDzMQgK4QegQIARAC)ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œä»¥ä¾¿æœåŠ¡å™¨çŸ¥é“ä»å“ªé‡Œç»§ç»­æ¨é€ï¼Œä¿è¯æ•°æ®æµçš„è¿ç»­æ€§ï¼Œè€Œå¼€å‘è€…å¯ä»¥é€šè¿‡è®¾ç½®`eventSource.retry`å±æ€§æ¥è°ƒæ•´é‡è¿é—´éš”ã€‚Â 

**SSEè‡ªåŠ¨é‡è¿çš„åŸç†**

- **è‡ªåŠ¨é‡è¯•**: SSEåè®®è§„èŒƒè§„å®šï¼Œè¿æ¥å¤±è´¥åæµè§ˆå™¨ä¼šå°è¯•æ¢å¤è¿æ¥ã€‚
- **äº‹ä»¶IDï¼ˆEvent IDï¼‰**: å®¢æˆ·ç«¯ä¼šä¿å­˜ä¸Šæ¬¡æ¥æ”¶åˆ°çš„[event ID](https://www.google.com/search?q=event+ID&mstk=AUtExfD4k-H1zLkKNieG3LHeEYQiTTR08D6tnYzotxg1ZpHlStFXPT0qYs4qHgj6e1VZHj7a9193CJZPdf5-bApTnz0VjrQzRxOEjh14bCn9zs8e9qtCNUOOiYHKLOwnmfxH137usJMdJ3NNswahx8FT58EkRjOMlctF5xzkENiZAoVFqd6rdnhB7lHLPwMP6rP7HoKdbE0dYSFv817ffrnN9uKRBzYR1Yn874z969hOrNJrgCfHhwpeqfs4OsQ2sMeA5ByAx8kYDat1G5SeQT6UIeta&csui=3&ved=2ahUKEwjpr-S-9N-RAxXMTmwGHRxaDzMQgK4QegQIAxAC)ï¼Œé‡è¿æ—¶ä¼šé€šè¿‡ HTTP å¤´éƒ¨å‘é€ç»™æœåŠ¡å™¨ï¼Œå‘Šè¯‰æœåŠ¡å™¨ä»å“ªä¸ªäº‹ä»¶IDä¹‹åçš„æ¶ˆæ¯å¼€å§‹å‘é€ã€‚
- **å¯é…ç½®é‡è¿é—´éš”**: ä½ å¯ä»¥ä½¿ç”¨ JavaScript è®¿é—®Â `EventSource`Â å¯¹è±¡çš„Â `retry`Â å±æ€§æ¥è®¾ç½®æµè§ˆå™¨é‡è¯•è¿æ¥çš„é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼Œä¾‹å¦‚Â `eventSource.retry = 5000;`Â è¡¨ç¤ºæ¯ 5 ç§’é‡è¯•ä¸€æ¬¡ã€‚

> SSE æœ¬èº«å°±æ˜¯å•å‘çš„ï¼ˆæœåŠ¡ç«¯â†’å®¢æˆ·ç«¯çš„é•¿è¿æ¥ï¼‰ï¼ŒLittle Master é‡Œç”¨æˆ·â€œå‘é€æ¶ˆæ¯â€èµ°çš„æ˜¯æ™®é€š HTTP è¯·æ±‚ï¼ˆPOSTï¼‰ï¼Œåªæ˜¯å¤ç”¨åŒä¸€ä¸ª SSE æµæ¥æ¥æ”¶åç»­å“åº”ã€‚æ•´ä½“æ•ˆæœçœ‹ä¸Šå»åƒåŒå‘ï¼Œä½†æŠ€æœ¯ä¸Šæ˜¯ï¼š
> - ä¸Šè¡Œï¼šLittleMasterConnectionProvider.connect è°ƒç”¨ SseService.streamMessagesï¼Œåœ¨å»ºç«‹ SSE å‰å…ˆæŠŠè¯·æ±‚ä½“é€šè¿‡ POST å‘é€å‡ºå»ï¼ˆLittleMasterHttpClient.subscribeToSSE çš„ POST åˆ†æ”¯ï¼‰ï¼Œè¿™æ˜¯ä¸€æ¬¡æ€§è¯·æ±‚ã€‚
> - ä¸‹è¡Œï¼šåŒä¸€ä¸ªè¯·æ±‚è¿”å›çš„æ˜¯ text/event-streamï¼Œåç»­æ‰€æœ‰ç»“æœé€šè¿‡ SSE å•å‘æ¨é€ã€‚

  

Â  æ‰€ä»¥é€šé“æ˜¯å•å‘çš„ SSEï¼Œä¸‹è¡Œï¼›ä¸Šè¡Œç”¨æ™®é€š HTTP è¯·æ±‚ï¼Œä¸¤è€…ç»„åˆå®ç°â€œç±»ä¼¼åŒå‘â€çš„äº¤äº’ã€‚

### B. è§£è€¦æ ¸å¿ƒï¼šç­–ç•¥æ¨¡å¼ + Parser Registry

ä¸ºäº†æ¶ˆé™¤è‡ƒè‚¿çš„åˆ¤æ–­é€»è¾‘ï¼Œæˆ‘è®¾è®¡äº†ä¸€å¥—**åˆ†å±‚è§£ææ³¨å†Œç³»ç»Ÿ**ã€‚

- **ä¼ ç»Ÿæ–¹æ¡ˆ**ï¼šç¡¬ç¼–ç åˆ¤æ–­ï¼Œé€»è¾‘è€¦åˆã€‚
    
- **æˆ‘çš„æ–¹æ¡ˆ**ï¼šé€šè¿‡æ³¨å†Œå™¨ç»Ÿä¸€ç®¡ç†è§£æç­–ç•¥ã€‚
    

```Dart
// æ¶æ„å®ç°ï¼šç»Ÿä¸€æ³¨å†Œï¼Œä¸€è¡Œä»£ç æ¥å…¥æ–°ç±»å‹
SseJsonParserRegistry.registerParser('message', 'voteCard', _parseVoteCard);

// ç»Ÿä¸€è§£æå…¥å£ï¼šé€šè¿‡ Registry è‡ªåŠ¨åˆ†å‘
final result = SseJsonParserRegistry.parse(eventType, jsonData);
```

#### Parser Registry è¯¦è§£
##### è¦è§£å†³çš„é—®é¢˜

- SSE è¿”å›çš„ JSON æ ¼å¼å¤šä¸”æ˜“å˜ï¼ˆreason æµã€æ–‡æœ¬ã€å»ºè®®å¡ã€æ··åˆå¡ã€è¯„ä»·/è¯„åˆ†å¡ã€é¡¹ç›®åˆ—è¡¨ã€æ’­æŠ¥ã€å›ºå®šæ ¼å¼å¡ç­‰ï¼‰ã€‚

- è¿‡å»ç”¨å¤§ if/elseï¼ˆæˆ–å¤šç­–ç•¥ç±»ï¼‰æ—¢éš¾è¯»åˆéš¾æ‰©å±•ï¼Œæ–°å¢ä¸€ç§æ ¼å¼è¦æ”¹ä¸€å †åˆ†æ”¯ï¼Œå®¹æ˜“å‡ºé”™ã€‚

- ç›®æ ‡ï¼šæŠŠâ€œè¯†åˆ«ç±»å‹â€ä¸â€œå…·ä½“è§£æâ€è§£è€¦ï¼Œå½¢æˆå¯æ³¨å†Œã€å¯æ¼”è¿›ã€å¯å¤ç”¨çš„è§£æç®¡çº¿ã€‚

##### æ ¸å¿ƒç»“æ„

  - è·¯ç”±è¡¨ _parsers[eventType][messageType]ï¼šåŒé”®å®šä½è§£æå‡½æ•°ï¼Œé¿å…å±‚å±‚æ¡ä»¶åˆ¤æ–­ï¼ˆcommon/core/sse_json_parser_registry.dartï¼‰ã€‚

  - è‡ªåŠ¨æ¢æµ‹å™¨ _messageDetectorsï¼šä¸€ç»„æŒ‰ä¼˜å…ˆçº§æ’å¥½çš„å‡½æ•°ï¼ˆsuggestionã€mixed_cardã€evaluationã€scoreã€itemListCardã€plainTextCardã€submitResultã€å›ºå®šæ ¼å¼ã€é¡¹ç›®è¯„åˆ†ã€æ’­æŠ¥â€¦ï¼‰ï¼Œé€ä¸ªå°è¯•ï¼Œå‘½ä¸­å³è¿”å› messageTypeã€‚

  - ç»Ÿä¸€è¾“å‡ºæ¨¡å‹ SseEventDataï¼šè§£æç»“æœå¼ºåˆ¶æ”¶æ•›ä¸º text/card/id/status/isComplete/isErrorï¼Œåç»­å¤„ç†å™¨æ— éœ€å…³å¿ƒåŸå§‹ JSON ç»†èŠ‚ã€‚

  - æ³¨å†Œå…¥å£ registerParser(eventType, messageType, parser)ï¼šä¸šåŠ¡æ–°å¢æ ¼å¼æ—¶æ— éœ€åŠ¨æ ¸å¿ƒé€»è¾‘ï¼Œç›´æ¥æŒ‚è½½è§£æå™¨ã€‚

 ##### è¿è¡Œé“¾è·¯ï¼ˆè®²ç»™é¢è¯•å®˜çš„æµæ°´ï¼‰

  1. parse(eventType, data) è¢«è°ƒç”¨ã€‚

  2. _detectMessageTypeï¼š

	  - å…ˆçœ‹ eventTypeï¼ˆreason/message/suggestion/close/errorâ€¦ï¼‰ã€‚

	  - å¯¹ message äº‹ä»¶ï¼Œä¾æ¬¡è·‘ _messageDetectors æ‰¾å‡ºæœ€åŒ¹é…çš„ messageTypeï¼›æ‰¾ä¸åˆ°å°±ç»™é»˜è®¤ direct_textã€‚

  3. è·¯ç”±æŸ¥æ‰¾ï¼šç”¨ eventType + messageType åœ¨ _parsers å–è§£æå‡½æ•°ï¼›æœªå‘½ä¸­è¿”å›ç©ºæ•°æ®ï¼Œå¼‚å¸¸èµ° _createFallbackDataã€‚

  4. è§£æå‡½æ•°äº§å‡º SseEventDataï¼ˆå« text æˆ– cardã€çŠ¶æ€ã€é”™è¯¯æ ‡è®°ï¼‰ã€‚

  5. ä¸‹æ¸¸ SseEventHandlerFactory ä¾æ® SseEventData å†™å…¥å¯¹è¯æ¨¡å‹ï¼Œå®Œå…¨ä¸ç”¨å…³å¿ƒ JSON ç»†èŠ‚ã€‚

##### æ‰©å±•ç¤ºä¾‹ï¼ˆä¸¤æ­¥èµ°ï¼‰

  1. æœ‰æ–°å¡ç‰‡ fooCardï¼Œç‰¹å¾æ˜¯ content.message.content.type == 'fooCard'ã€‚å†™ä¸€ä¸ª detectorï¼ˆå¯é€‰ï¼Œå¦‚æœç‰¹å¾ç®€å•ä¹Ÿå¯ç›´æ¥æ³¨å†Œï¼‰ï¼š
```dart
	 static String? _detectFooCard(Map<String, dynamic> data) {
	   return data['content']?['message']?['content']?['type'] == 'fooCard' ? 'fooCard' : null;
	 }
```
å¹¶æŠŠå®ƒæ”¾è¿› _messageDetectorsã€‚

  2. æ³¨å†Œè§£æå™¨ï¼š

```dart
	 SseJsonParserRegistry.registerParser('message', 'fooCard', (data) {
	   final content = data['content']['message']['content'];
	   return SseEventData(card: {
		 'type': 'fooCard',
		 'id': content['id'],
		 'content': content['payload'],
	   });
	 });
```
ä¸åŠ¨å…¶ä»–ä»£ç å³å¯ç”Ÿæ•ˆã€‚

- å¥å£®æ€§è®¾è®¡

  - æ·±åº¦å®‰å…¨å–å€¼ _safeGetï¼Œé¿å… null/ç±»å‹é”™è¯¯ç›´æ¥æŠ›å¼‚å¸¸ã€‚

  - çŠ¶æ€é—¨æ§ï¼šå¦‚ itemListCard åœ¨ status == UPDATING æ—¶ç›´æ¥ç©ºè¿”å›ï¼Œé¿å… UI æ˜¾ç¤ºå ä½ã€‚

  - å…¼å®¹å¤šå¥—å­—æ®µå‘½åï¼šè¯„åˆ†å¡ eval/scoreã€æ’­æŠ¥å¡ camelCase/snake_case å…¼å®¹ã€‚

  - é”™è¯¯ä¸ fallbackï¼šé”™è¯¯äº‹ä»¶ä¸“é—¨è§£æ errorMessage/errorTypeï¼›æœªçŸ¥/å¼‚å¸¸æ—¶è¿”å› fallback æ–‡æœ¬ï¼Œç¡®ä¿ç”¨æˆ·èƒ½çœ‹åˆ°å¯ç”¨æç¤ºè€Œéå´©æºƒã€‚

- ä¸ºä»€ä¹ˆæ¯”ä¼ ç»Ÿ if/else å¥½

  - æ¸…æ™°è·¯ç”±ï¼šäº‹ä»¶ç»´åº¦ + æ¶ˆæ¯ç»´åº¦åŒé”®å®šä½ï¼Œé˜…è¯»å’Œè°ƒè¯•æˆæœ¬ä½ã€‚

  - å¼€æ”¾å°é—­ï¼šæ–°å¢ç±»å‹é æ³¨å†Œè€Œéæ”¹æ—§åˆ†æ”¯ï¼Œé™ä½å›å½’é£é™©ã€‚

  - å¤ç”¨/éš”ç¦»ï¼šä¸åŒä¸šåŠ¡åœºæ™¯ï¼ˆè¯·é—®/çº¦å·¥/æ’­æŠ¥/è¯„åˆ†ï¼‰å…±ç”¨åŒä¸€æ¡†æ¶ï¼Œå·®å¼‚è¢« messageType éš”ç¦»ï¼Œé¿å…é‡å¤è§£æä»£ç ã€‚

  - æµ‹è¯•å‹å¥½ï¼šæ¯ä¸ªè§£æå™¨æ˜¯çº¯å‡½æ•°ï¼Œå…¥å‚å‡ºå‚æ˜ç¡®ï¼›å¯å•æµ‹ detector å’Œ parserï¼Œä¸ä¾èµ– UIã€‚

  - å®¹é”™å¼ºï¼šé¢å¯¹è„æ•°æ®ã€å ä½æµã€é”™è¯¯äº‹ä»¶æœ‰å…œåº•ï¼Œç”¨æˆ·ä½“éªŒç¨³å®šã€‚

- è®²è§£æ—¶çš„å½¢è±¡æ¯”å–»

  - æŠŠå®ƒæ¯”ä½œâ€œæµ·å…³åˆ†æ‹£â€ï¼šå…ˆçœ‹å…¥å¢ƒå£ï¼ˆeventTypeï¼‰ï¼Œå†çœ‹è´§ç‰©ç±»å‹æ ‡ç­¾ï¼ˆmessageTypeï¼‰ã€‚åŒ¹é…åˆ°çª—å£åç”±ä¸“äººï¼ˆè§£æå‡½æ•°ï¼‰æ‹†åŒ…ï¼Œæœ€ç»ˆéƒ½è½¬æˆæ ‡å‡†çš„æ‰˜ç›˜ï¼ˆSseEventDataï¼‰é€å¾€ä»“åº“ï¼ˆHandler/UIï¼‰ã€‚æ–°å¢è´§ç‰©ç±»å‹åªè¦å†è®¾ä¸€ä¸ªçª—å£ï¼Œä¸ç”¨æ”¹æ—§çª—å£è§„åˆ™ã€‚


### C. å¤æ‚çŠ¶æ€æ²»ç†ï¼šFragment çº§åˆ«å±€éƒ¨æ›´æ–°

é’ˆå¯¹æµå¼æ›´æ–°å¸¦æ¥çš„æ€§èƒ½æŒ‘æˆ˜ï¼Œæˆ‘å®ç°äº†**ç»†ç²’åº¦çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ**ï¼š

1. **åˆ†å±‚è™šæ‹ŸåŒ–**ï¼šå°†å¯¹è¯æ‹†è§£ä¸ºæœ€å°å•å…ƒï¼ˆFragmentï¼‰ã€‚
    
2. **å±€éƒ¨é‡å»º**ï¼šåˆ©ç”¨ `Provider` çš„ `Selector` æˆ– `Consumer` æœºåˆ¶ï¼Œç¡®ä¿åªæœ‰å½“å‰æ­£åœ¨æ›´æ–°çš„æ–‡æœ¬ç‰‡æ®µè§¦å‘é‡ç»˜ï¼Œç°æœ‰å†å²æ¶ˆæ¯ä¿æŒé™é»˜ã€‚
    
3. **çŠ¶æ€è‡ªæ²»**ï¼šå¡ç‰‡å†…éƒ¨ï¼ˆå¦‚å¤šé€‰ã€è¯„åˆ†ï¼‰æ‹¥æœ‰ç‹¬ç«‹çŠ¶æ€æœºï¼Œé¿å…çˆ¶çº§ä¸šåŠ¡é€»è¾‘å¹²æ‰° UI æ¸²æŸ“ã€‚
    

---

## 3. æ·±åº¦è§£æï¼šå¦‚ä½•å®ç°â€œä¸€è¡Œä»£ç æ³¨å†Œâ€ï¼Ÿ

é¢è¯•å®˜å¸¸é—®ï¼šâ€œä½ è¯´ä¸€è¡Œä»£ç æ³¨å†Œï¼Œé‚£ UI è§£æé€»è¾‘å»å“ªäº†ï¼Ÿâ€

åº•å±‚æ ¸å¿ƒåœ¨äºâ€œèŒè´£åˆ†ç¦»â€çš„å¤šå±‚æ˜ å°„æ¶æ„ï¼š

|**å±‚æ¬¡**|**èŒè´£**|**å˜åŠ¨é¢‘ç‡**|
|---|---|---|
|**Layer 1: è§£æå±‚**|**JSON â†’ æ ‡å‡†æ•°æ® (SseEventData)**ã€‚è´Ÿè´£å­—æ®µæå–ä¸æ¸…æ´—ã€‚|éšåç«¯åè®®å˜åŠ¨|
|**Layer 2: æ¨¡å‹å±‚**|**æ ‡å‡†æ•°æ® â†’ ä¸šåŠ¡å¯¹è±¡ (MessageModel)**ã€‚è´Ÿè´£ç±»å‹å®‰å…¨çº¦æŸã€‚|ç¨³å®š|
|**Layer 3: æ¸²æŸ“å±‚**|**ä¸šåŠ¡å¯¹è±¡ â†’ Widget**ã€‚è´Ÿè´£ UI é€»è¾‘ä¸äº¤äº’ã€‚|éšè®¾è®¡ç¨¿å˜åŠ¨|

**ç»“è®º**ï¼šæ‰€è°“çš„â€œä¸€è¡Œä»£ç â€æ˜¯æŒ‡**æ¶æ„å±‚é¢çš„æŒ‚è½½**ã€‚é€šè¿‡è¿™ç§è®¾è®¡ï¼Œæˆ‘å°†åŸæœ¬æ•£è½åœ¨å„å¤„çš„ `if-else` è½¬åŒ–ä¸ºäº†ç»“æ„åŒ–çš„ä¸šåŠ¡å®ç°ï¼Œæ–°åŠŸèƒ½çš„å¼€å‘åªæ¶‰åŠâ€œå¢é‡ä»£ç â€ï¼Œè€Œéâ€œä¿®æ”¹æ—§ä»£ç â€ã€‚

---

## 4. æŠ€æœ¯æˆæœ (What)

- **ç ”å‘æ•ˆèƒ½**ï¼šæ–°å¢æ¶ˆæ¯ç±»å‹çš„é›†æˆå·¥ä½œé‡é™ä½äº† **80%**ï¼Œè§£æå±‚å®ç°â€œé›¶è€¦åˆâ€ã€‚
    
- **è¿è¡Œæ€§èƒ½**ï¼šåœ¨ 100+ æ¡æ¶ˆæ¯çš„é•¿åˆ—è¡¨ä¸­ï¼Œæµå¼æ›´æ–°å¸§ç‡ç¨³å®šåœ¨ **60FPS**ï¼Œé‡ç»˜åŒºåŸŸç¼©å°äº† **95%** ä»¥ä¸Šã€‚
    
- **å¥å£®æ€§**ï¼šå´©æºƒç‡æ§åˆ¶åœ¨ **0.01%**ï¼Œé€šè¿‡ SSE çŠ¶æ€æœºè‡ªæ„ˆæœºåˆ¶ï¼Œå¼±ç½‘ç¯å¢ƒä¸‹çš„é‡è¿æˆåŠŸç‡æå‡äº† **40%**ã€‚
    

---

## ğŸ’¡ é¢è¯•å®˜é«˜é¢‘ Q&A æ¨¡æ‹Ÿ

> Q1ï¼šä¸ºä»€ä¹ˆä¸ç”¨ WebSocket è€Œé€‰æ‹© SSEï¼Ÿ
> 
> Aï¼šé¦–å…ˆï¼ŒAI åœºæ™¯æ˜¯å…¸å‹çš„å•å‘æ¨é€ï¼ŒSSE åè®®æ›´è½»é‡ã€å¼€é”€æ›´å°ï¼›å…¶æ¬¡ï¼ŒSSE åŸºäºæ ‡å‡† HTTPï¼Œå¤©ç„¶æ”¯æŒè‡ªåŠ¨é‡è¿å’Œ Event ID æ–­ç‚¹ç»­ä¼ ï¼Œè€Œ WebSocket éœ€è¦è‡ªç ”å¿ƒè·³åŒ…å’Œé‡è¿é€»è¾‘ã€‚

> Q2ï¼šParser Registry ä½¿ç”¨äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Ÿ
> 
> Aï¼šå®ƒç»“åˆäº†ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰ä¸ç®€å•å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰ã€‚ç­–ç•¥æ¨¡å¼è´Ÿè´£è§£æç®—æ³•çš„æ›¿æ¢ï¼Œå·¥å‚æ¨¡å¼è´Ÿè´£æ ¹æ®åç«¯è¿”å›çš„ type åŠ¨æ€åˆ›å»ºè§£æå¯¹è±¡ã€‚

> Q3ï¼šå¦‚ä½•å¤„ç†æå…¶å¤æ‚çš„åµŒå¥—å¡ç‰‡ï¼ˆå¦‚å¤šå±‚è¡¨å•ï¼‰ï¼Ÿ
> 
> Aï¼šæˆ‘å¼•å…¥äº†åˆ†å±‚è™šæ‹ŸåŒ–ç´¢å¼•ã€‚æ„å»ºâ€œç›®å½•-ç´¢å¼•-é¡¹ç›®â€çš„ä¸‰çº§æ˜ å°„å…³ç³»ï¼Œå°†æœç´¢å’Œå®šä½çš„å¤æ‚åº¦ä» $O(n)$ é™è‡³ $O(1)$ï¼Œå³ä½¿æ˜¯åƒçº§æ¡ç›®çš„å¤æ‚è¡¨å•ä¹Ÿèƒ½å®ç°æ¯«ç§’çº§è·³è½¬ã€‚